{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axios from 'axios';\nimport { API_URL } from \"../config\";\nvar AsyncStorage;\ntry {\n  AsyncStorage = require('@react-native-async-storage/async-storage').default;\n} catch (error) {\n  console.warn('AsyncStorage not installed, falling back to localStorage');\n  AsyncStorage = {\n    getItem: function () {\n      var _getItem = _asyncToGenerator(function* (key) {\n        try {\n          return typeof window !== 'undefined' ? window.localStorage.getItem(key) : null;\n        } catch (e) {\n          return null;\n        }\n      });\n      function getItem(_x) {\n        return _getItem.apply(this, arguments);\n      }\n      return getItem;\n    }(),\n    setItem: function () {\n      var _setItem = _asyncToGenerator(function* (key, value) {\n        try {\n          if (typeof window !== 'undefined') window.localStorage.setItem(key, value);\n        } catch (e) {}\n      });\n      function setItem(_x2, _x3) {\n        return _setItem.apply(this, arguments);\n      }\n      return setItem;\n    }(),\n    removeItem: function () {\n      var _removeItem = _asyncToGenerator(function* (key) {\n        try {\n          if (typeof window !== 'undefined') window.localStorage.removeItem(key);\n        } catch (e) {}\n      });\n      function removeItem(_x4) {\n        return _removeItem.apply(this, arguments);\n      }\n      return removeItem;\n    }()\n  };\n}\nvar api = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\napi.interceptors.request.use(function () {\n  var _ref = _asyncToGenerator(function* (config) {\n    try {\n      var token = yield AsyncStorage.getItem('userToken');\n      if (token) {\n        config.headers.Authorization = `Bearer ${token}`;\n      }\n    } catch (error) {\n      console.error('Error retrieving token', error);\n    }\n    return config;\n  });\n  return function (_x5) {\n    return _ref.apply(this, arguments);\n  };\n}(), function (error) {\n  return Promise.reject(error);\n});\nexport var loginUser = function () {\n  var _ref2 = _asyncToGenerator(function* (email, password) {\n    try {\n      var response = yield api.post('/api/auth/login', {\n        username: email,\n        password: password\n      });\n      if (response.data.access_token) {\n        yield AsyncStorage.setItem('userToken', response.data.access_token);\n      }\n      return response.data;\n    } catch (error) {\n      throw error.response ? error.response.data : error;\n    }\n  });\n  return function loginUser(_x6, _x7) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var getUserDetails = function () {\n  var _ref3 = _asyncToGenerator(function* () {\n    try {\n      var response = yield api.get('/api/auth/me');\n      return response.data;\n    } catch (error) {\n      throw error.response ? error.response.data : error;\n    }\n  });\n  return function getUserDetails() {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var logoutUser = function () {\n  var _ref4 = _asyncToGenerator(function* () {\n    try {\n      yield AsyncStorage.removeItem('userToken');\n    } catch (error) {\n      console.error('Error removing token', error);\n    }\n  });\n  return function logoutUser() {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport default api;","map":{"version":3,"names":["axios","API_URL","AsyncStorage","require","default","error","console","warn","getItem","_getItem","_asyncToGenerator","key","window","localStorage","e","_x","apply","arguments","setItem","_setItem","value","_x2","_x3","removeItem","_removeItem","_x4","api","create","baseURL","headers","interceptors","request","use","_ref","config","token","Authorization","_x5","Promise","reject","loginUser","_ref2","email","password","response","post","username","data","access_token","_x6","_x7","getUserDetails","_ref3","get","logoutUser","_ref4"],"sources":["C:/Users/vrajr/Downloads/gujarat-unified-services-portal-grants-and-improvements/gujarat-unified-services-portal-grants-and-improvements/mobile-app/src/services/api.js"],"sourcesContent":["import axios from 'axios';\r\nimport { API_URL } from '../config';\r\n\r\n// Safe AsyncStorage import\r\nlet AsyncStorage;\r\ntry {\r\n    AsyncStorage = require('@react-native-async-storage/async-storage').default;\r\n} catch (error) {\r\n    console.warn('AsyncStorage not installed, falling back to localStorage');\r\n    AsyncStorage = {\r\n        getItem: async (key) => {\r\n            try {\r\n                return typeof window !== 'undefined' ? window.localStorage.getItem(key) : null;\r\n            } catch (e) { return null; }\r\n        },\r\n        setItem: async (key, value) => {\r\n            try {\r\n                if (typeof window !== 'undefined') window.localStorage.setItem(key, value);\r\n            } catch (e) { }\r\n        },\r\n        removeItem: async (key) => {\r\n            try {\r\n                if (typeof window !== 'undefined') window.localStorage.removeItem(key);\r\n            } catch (e) { }\r\n        }\r\n    };\r\n}\r\n\r\nconst api = axios.create({\r\n    baseURL: API_URL,\r\n    headers: {\r\n        'Content-Type': 'application/json',\r\n    },\r\n});\r\n\r\n// Add a request interceptor to include the auth token\r\napi.interceptors.request.use(\r\n    async (config) => {\r\n        try {\r\n            const token = await AsyncStorage.getItem('userToken');\r\n            if (token) {\r\n                config.headers.Authorization = `Bearer ${token}`;\r\n            }\r\n        } catch (error) {\r\n            console.error('Error retrieving token', error);\r\n        }\r\n        return config;\r\n    },\r\n    (error) => {\r\n        return Promise.reject(error);\r\n    }\r\n);\r\n\r\nexport const loginUser = async (email, password) => {\r\n    try {\r\n        const response = await api.post('/api/auth/login', {\r\n            username: email, // FastAPI OAuth2 expects 'username' (which is email here)\r\n            password: password,\r\n        });\r\n        if (response.data.access_token) {\r\n            await AsyncStorage.setItem('userToken', response.data.access_token);\r\n        }\r\n        return response.data;\r\n    } catch (error) {\r\n        throw error.response ? error.response.data : error;\r\n    }\r\n};\r\n\r\nexport const getUserDetails = async () => {\r\n    try {\r\n        const response = await api.get('/api/auth/me');\r\n        return response.data;\r\n    } catch (error) {\r\n        throw error.response ? error.response.data : error;\r\n    }\r\n};\r\n\r\nexport const logoutUser = async () => {\r\n    try {\r\n        await AsyncStorage.removeItem('userToken');\r\n    } catch (error) {\r\n        console.error('Error removing token', error);\r\n    }\r\n};\r\n\r\nexport default api;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}